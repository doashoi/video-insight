ROSTemplateFormatVersion: '2015-09-01'
Transform: 'Aliyun::Serverless-2018-04-03'
Resources:
  SenseVoiceService:
    Type: Aliyun::Serverless::Service
    Properties:
      Role: 'acs:ram::YOUR_ACCOUNT_ID:role/AliyunFCRole'
      VpcConfig:
        VpcId: 'vpc-xxx'           # 用户替换
        VSwitchIds: ['vsw-xxx']    # 用户替换
        SecurityGroupId: 'sg-xxx'  # 用户替换
      LogConfig:
        Project: 'fc-logs'
        Logstore: 'sensevoice'
   
  SenseVoiceFunction:
    Type: Aliyun::Serverless::Function
    Properties:
      Runtime: custom-container
      MemorySize: 3072
      InstanceType: e1
      Timeout: 60
      InitializationTimeout: 300
      InstanceConcurrency: 5
      EnvironmentVariables:
        OSS_BUCKET: 'video-insight-models'
        OSS_ENDPOINT: 'vpc100-oss-cn-hangzhou.aliyuncs.com'  # VPC内网Endpoint
        MODEL_PATH: '/tmp/models'
        MODEL_SIZE_MB: '600'
        # 保留原有的业务环境变量
        FEISHU_APP_ID: ${env(FEISHU_APP_ID)}
        FEISHU_APP_SECRET: ${env(FEISHU_APP_SECRET)}
        FEISHU_VERIFICATION_TOKEN: ${env(FEISHU_VERIFICATION_TOKEN)}
        FEISHU_ENCRYPT_KEY: ${env(FEISHU_ENCRYPT_KEY)}
        FEISHU_FOLDER_TOKEN: ${env(FEISHU_FOLDER_TOKEN)}
        DASHSCOPE_API_KEY: ${env(DASHSCOPE_API_KEY)}
        SOURCE_APP_TOKEN: ${env(SOURCE_APP_TOKEN)}
        SOURCE_TABLE_ID: ${env(SOURCE_TABLE_ID)}
        WIKI_TOKEN: ${env(WIKI_TOKEN)}
        ANALYSIS_TABLE_ID: ${env(ANALYSIS_TABLE_ID)}
        ANALYSIS_VIEW_ID: ${env(ANALYSIS_VIEW_ID)}
        DEST_APP_TOKEN: ${env(DEST_APP_TOKEN)}
        DEST_TABLE_ID: ${env(DEST_TABLE_ID)}
      CustomContainerConfig:
        Image: 'registry.cn-hangzhou.aliyuncs.com/video-insight/sensevoice:latest_accelerated'
        AccelerationType: Default
      ProvisionedConfig:
        Target: 1
